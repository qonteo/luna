
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Installation and setup &#8212; Luna-python-server-admin v.1.0.4 documentation</title>
    <link rel="stylesheet" href="_static/haiku.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Database" href="database.html" />
    <link rel="prev" title="Introduction" href="introduce.html" /> 
  </head><body>
      <div class="header" role="banner"><h1 class="heading"><a href="index.html">
          <span>Luna-python-server-admin v.1.0.4 documentation</span></a></h1>
        <h2 class="heading"><span>Installation and setup</span></h2>
      </div>
      <div class="topnav" role="navigation" aria-label="top navigation">
      
        <p>
        «&#160;&#160;<a href="introduce.html">Introduction</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="index.html">Contents</a>
        &#160;&#160;::&#160;&#160;
        <a href="database.html">Database</a>&#160;&#160;»
        </p>

      </div>
      <div class="content">
        
        
  <div class="section" id="installation-and-setup">
<h1>Installation and setup<a class="headerlink" href="#installation-and-setup" title="Permalink to this headline">¶</a></h1>
<div class="section" id="surroundings">
<h2>Surroundings<a class="headerlink" href="#surroundings" title="Permalink to this headline">¶</a></h2>
<p>Administration panel service operates with Windows 10 and CentOS 7 (other OS have not been tested).</p>
<p>Following software is required for administration panel service installation:</p>
<ul class="simple">
<li>PostgreSQL developer package;</li>
<li>PostgreSQL DBMS instance (not recommended use LUNA API database);</li>
<li>Python 3.5 or newer;</li>
<li>Python setuptools.</li>
</ul>
<p>For more details about each component installation, please refer to the LUNA API documentation.</p>
</div>
<div class="section" id="installation">
<h2>Installation<a class="headerlink" href="#installation" title="Permalink to this headline">¶</a></h2>
<p>Before beginning, make sure you have LUNA Core and LUNA API up and functional. First, install Python dependencies by performing the following command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python setup.py install
</pre></div>
</div>
<p>In this case, versioning is based on git.  If the project is not cloned, use the following command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pip install -r requirements.txt
</pre></div>
</div>
<p>Note: the virtual environment is strongly recommended for installation.</p>
</div>
<div class="section" id="configuration">
<h2>Configuration<a class="headerlink" href="#configuration" title="Permalink to this headline">¶</a></h2>
<p>All configurations are in configs/config.py file. You can change the file according to your needs or create your file.</p>
<p>Note: all options except garbage collectors must be synchronized with LUNA API options.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">LUNA_API_DB_TYPE</span> <span class="o">=</span> <span class="s2">&quot;postgres&quot;</span>                                    <span class="c1">#: Luna API database type: postgres, oracle, default postgres</span>
<span class="n">LUNA_API_DB_USER_NAME</span> <span class="o">=</span> <span class="s2">&quot;faceis&quot;</span>                                 <span class="c1">#: Luna API database login</span>
<span class="n">LUNA_API_DB_PASSWORD</span> <span class="o">=</span> <span class="s2">&quot;faceis&quot;</span>                                  <span class="c1">#: Luna API database password</span>
<span class="n">LUNA_API_DB_PORT</span> <span class="o">=</span> <span class="mi">5432</span>                                          <span class="c1">#: Luna API database ip-address</span>
<span class="n">LUNA_API_DB_HOST</span> <span class="o">=</span> <span class="s2">&quot;127.0.0.1&quot;</span>                                   <span class="c1">#: Luna API database listener port, 5432 - default port of postgres, 1521 - default port of oracle</span>
<span class="n">LUNA_API_DB_NAME</span> <span class="o">=</span> <span class="s2">&quot;faceis_db&quot;</span>                                   <span class="c1">#: Luna API database name for postgres, sid for oracle</span>

<span class="n">ADMIN_DB_TYPE</span> <span class="o">=</span> <span class="s2">&quot;postgres&quot;</span>                                       <span class="c1">#: Admin database type: postgres, oracle, default postgres</span>
<span class="n">ADMIN_DB_USER_NAME</span> <span class="o">=</span> <span class="s2">&quot;faceis&quot;</span>                                    <span class="c1">#: Admin database login</span>
<span class="n">ADMIN_DB_PASSWORD</span> <span class="o">=</span> <span class="s2">&quot;faceis&quot;</span>                                     <span class="c1">#: Admin database password</span>
<span class="n">ADMIN_DB_HOST</span> <span class="o">=</span> <span class="s2">&quot;127.0.0.1&quot;</span>                                      <span class="c1">#: Admin database ip-address</span>
<span class="n">ADMIN_DB_PORT</span> <span class="o">=</span> <span class="mi">5432</span>                                             <span class="c1">#: Admin database listener port, 5432 - default port of postgres, 1521 - default port of oracle</span>
<span class="n">ADMIN_DB_NAME</span> <span class="o">=</span> <span class="s2">&quot;admin_faceis_db&quot;</span>                                <span class="c1">#: Admin database name for postgres, sid for oracle, where necessary schemes are created</span>

<span class="n">LUNA_CORE_ORIGIN</span> <span class="o">=</span> <span class="s2">&quot;http://127.0.0.1:8083&quot;</span>                       <span class="c1">#: LUNA Core listens origin</span>
<span class="n">LUNA_CORE_API_VERSION</span> <span class="o">=</span> <span class="mi">14</span>                                       <span class="c1">#: LUNA Core api version</span>

<span class="n">LUNA_CORE_REEXTRACT_ORIGIN</span> <span class="o">=</span> <span class="s2">&quot;http://127.0.0.1:8083&quot;</span>             <span class="c1">#: LUNA Core with new type of descriptors origin</span>
<span class="n">LUNA_CORE_REEXTRACT_API_VERSION</span> <span class="o">=</span> <span class="mi">14</span>                             <span class="c1">#: LUNA Core with new type of descriptors api version</span>

<span class="n">LUNA_IMAGE_STORE_WARPED_IMAGES_ORIGIN</span> <span class="o">=</span> <span class="s2">&quot;http://127.0.0.1:5020&quot;</span>  <span class="c1">#: service for storing warp images from LUNA Core service origin</span>
<span class="n">LUNA_IMAGE_STORE_WARPED_IMAGES_API_VERSION</span> <span class="o">=</span> <span class="mi">1</span>                   <span class="c1">#: service for storing warp images from LUNA Core version api</span>
<span class="n">LUNA_IMAGE_STORE_WARPED_IMAGES_BUCKET</span> <span class="o">=</span> <span class="s2">&quot;visionlabs-warps&quot;</span>       <span class="c1">#: service for storing warp images from LUNA Core bucket</span>

<span class="n">SEND_TO_LUNA_IMAGE_STORE</span> <span class="o">=</span> <span class="mi">1</span>                                     <span class="c1">#: flag, which indicates whether to send portraits to LUNA_IMAGE_STORE</span>
<span class="n">LUNA_IMAGE_STORE_PORTRAITS_ORIGIN</span> <span class="o">=</span> <span class="s2">&quot;http://127.0.0.1:5020&quot;</span>      <span class="c1">#: origin of service for storing portraits from LUNA Api</span>
<span class="n">LUNA_IMAGE_STORE_PORTRAITS_BUCKET</span> <span class="o">=</span> <span class="s2">&quot;portraits&quot;</span>                  <span class="c1">#: bucket for storing portraits from LUNA Api</span>
<span class="n">LUNA_IMAGE_STORE_PORTRAITS_API_VERSION</span> <span class="o">=</span> <span class="mi">1</span>                       <span class="c1">#: version api of service for storing portraits from LUNA Api</span>

<span class="n">LUNA_FACES_ORIGIN</span> <span class="o">=</span> <span class="s2">&quot;http://127.0.0.1:5030&quot;</span>                      <span class="c1">#: LUNA Faces origin</span>
<span class="n">LUNA_FACES_API_VERSION</span> <span class="o">=</span> <span class="mi">1</span>                                       <span class="c1">#: LUNA Faces api version</span>

<span class="n">ADMIN_STATISTICS_SERVER_ORIGIN</span> <span class="o">=</span> <span class="s2">&quot;http://127.0.0.1:8086&quot;</span>         <span class="c1">#: Influxdb server, where statistics is collected from LUNA API</span>
<span class="n">ADMIN_STATISTICS_DB</span> <span class="o">=</span> <span class="s2">&quot;luna_api_admin&quot;</span>                           <span class="c1">#: database with time series for administrator statistics from LUNA API</span>

<span class="n">GRAFANA_ORIGIN</span> <span class="o">=</span> <span class="s2">&quot;http://127.0.0.1:3010&quot;</span>                         <span class="c1">#: Grafana server  for visualized statistics</span>

<span class="n">TIMEOUT_GC_DESCRIPTORS</span> <span class="o">=</span> <span class="mi">7</span>                                       <span class="c1">#: timeout for descriptors gc (in days)</span>
<span class="n">LOG_LEVEL</span> <span class="o">=</span> <span class="s2">&quot;INFO&quot;</span>                                               <span class="c1">#: level of debug print, by priority: ERROR, WARNING, INFO, DEBUG</span>
<span class="n">LOG_TIME</span> <span class="o">=</span> <span class="s2">&quot;LOCAL&quot;</span>                                               <span class="c1">#: time for records in logs: LOCAL or UTC</span>
<span class="n">FOLDER_WITH_LOGS</span> <span class="o">=</span> <span class="s2">&quot;./&quot;</span>                                          <span class="c1">#: folder, where logs are saved</span>

<span class="n">TTL_DESCRIPTOR</span> <span class="o">=</span> <span class="mi">1</span>                                               <span class="c1">#: time to live  free descriptors</span>

<span class="n">ADMIN_TASKS_SERVER_ORIGIN</span> <span class="o">=</span> <span class="s2">&quot;http://127.0.0.1:5011&quot;</span>             <span class="c1">#: address, on which task service listens</span>

<span class="n">REQUEST_TIMEOUT</span> <span class="o">=</span> <span class="mi">60</span>                                             <span class="c1">#: timeout for http-request to internal services (core, faces, image-store)</span>
<span class="n">CONNECT_TIMEOUT</span> <span class="o">=</span> <span class="mi">30</span>                                             <span class="c1">#: timeout for connect to internal services (core, faces, image-store)</span>

<span class="n">ADMIN_REQUEST_TIMEOUT</span> <span class="o">=</span> <span class="mi">60</span>                                       <span class="c1">#: timeout for http-request to luna-admin task service</span>
<span class="n">ADMIN_CONNECT_TIMEOUT</span> <span class="o">=</span> <span class="mi">30</span>                                       <span class="c1">#: timeout for connect to luna-admin task service</span>
</pre></div>
</div>
</div>
<div class="section" id="database-creation">
<h2>Database creation<a class="headerlink" href="#database-creation" title="Permalink to this headline">¶</a></h2>
<p>After dependencies are installed, and all settings are configured, it is necessary to create a database (for more details refer to LUNA API documentation). Next, create a table using <em>db_create.py</em> script. The command is the following:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python ./bases_scripts/db_create.py --config<span class="o">=</span>./configs/myconfig.conf
</pre></div>
</div>
<p>The last command creates table in db, required for future service migration.</p>
</div>
<div class="section" id="graphana-dashboards-creation">
<h2>Graphana dashboards creation<a class="headerlink" href="#graphana-dashboards-creation" title="Permalink to this headline">¶</a></h2>
<p>For statistics visualization, you can use pre-arranged dashboards. To create one, run the commands:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>python ./luna_admin/create_grafana_dashboards.py --config<span class="o">=</span>./configs/myconfig.conf
</pre></div>
</div>
<p>Grafana dashboard creation is optional.</p>
</div>
<div class="section" id="startup">
<h2>Startup<a class="headerlink" href="#startup" title="Permalink to this headline">¶</a></h2>
<p>If all previous steps were performed successfully, a server is ready to work. Run the script <em>run.py</em>to start the server. When launching, you can add such arguments as port and workes’amount. By default, the servers listen the ports 5010 and 5011 and uses one worker. Example of the startup string:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./luna-admin/run.py --config<span class="o">=</span><span class="s2">&quot;./configs/myconf.conf&quot;</span> --service_type<span class="o">=</span>admin_backend
</pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./luna-admin/run.py --config<span class="o">=</span><span class="s2">&quot;./configs/myconf.conf&quot;</span> --service_type<span class="o">=</span>admin_task
</pre></div>
</div>
</div>
</div>


      </div>
      <div class="bottomnav" role="navigation" aria-label="bottom navigation">
      
        <p>
        «&#160;&#160;<a href="introduce.html">Introduction</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="index.html">Contents</a>
        &#160;&#160;::&#160;&#160;
        <a href="database.html">Database</a>&#160;&#160;»
        </p>

      </div>

    <div class="footer" role="contentinfo">
        &#169; Copyright 2017, VisionLabs.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.7.9.
    </div>
  </body>
</html>